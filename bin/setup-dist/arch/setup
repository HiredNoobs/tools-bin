#!/usr/bin/env bash
#
# The `setup` in the root directory will use these functions on arch.
# It doesn't do anything when executed directly.

function configure_bash {
  sudo pacman -S bash-completion
  rsync -av "$ROOT/dotfiles/.bashrc" ~/.bashrc
  rsync -av --delete "$ROOT/dotfiles/.config/bashrc/" "$XDG_CONFIG_HOME/bashrc/"
}

function configure_hyprland {
  log_info "Configuring hyprland."
  log_info "Installing dependencies."
  sudo pacman -S --needed hyprland xdg-desktop-portal-hyprland polkit-kde-agent \
    brightnessctl pamixer waybar blueman bluez swaync swaybg
  
  # Are qt6ct & kvantum the only ones actually in use?
  sudo pacman -S --needed qt5-wayland qt6-wayland qt5ct qt6ct kvantum
  
  # Should we just remove pywal from the deps and copy the theme into the repo?
  yay -S --needed hyprlock hypridle grimblast otf-codenewroman-nerd pywal

  # Application launcher
  yay -S --needed walker elephant-websearch elephant-calc elephant-files elephant-files \
    elephant-menus elephant-todo

  log_info "Dependencies installed. Starting configuration."

  # Using the wallpaper is nice is theory but it basically
  # just generates shades of blue with very little contrast...
  # Maybe there's some settings for wal that would help?
  # Or maybe I just need a wallpaper with more colors...
  # wal -i ~/bin/images/wallpapers/nord_scenary.png
  wal --theme base16-gruvbox-medium

  # Bluetooth will start in non-discoverable mode
  sudo sed -i -e 's/^\#AutoEnable=true/AutoEnable=false/' /etc/bluetooth/main.conf
  sudo systemctl enable bluetooth --now

  rsync -av "$ROOT/dotfiles/.config/starship.toml" ~/.config/starship.toml

  rsync -av --delete "$ROOT/dotfiles/.config/hypr/" "$XDG_CONFIG_HOME/hypr/"
  rsync -av --delete "$ROOT/dotfiles/.config/waybar/" "$XDG_CONFIG_HOME/waybar/"
  rsync -av --delete "$ROOT/dotfiles/.config/swaync/" "$XDG_CONFIG_HOME/swaync/"
  rsync -av --delete "$ROOT/dotfiles/.config/kitty/" "$XDG_CONFIG_HOME/kitty/"
  rsync -av --delete "$ROOT/dotfiles/.config/fish/" "$XDG_CONFIG_HOME/fish/"
  rsync -av --delete "$ROOT/dotfiles/.config/elephant/" "$XDG_CONFIG_HOME/elephant/"
  rsync -av --delete "$ROOT/dotfiles/.config/walker/" "$XDG_CONFIG_HOME/walker/"
}

function configure_docker {
  log_info "Installing docker and docker compose v2 latest."
  sudo pacman -S docker docker-compose

  log_info "Adding $USER to docker group"
  create_group docker
  add_user_to_group $USER docker

  log_info "Starting and enabling docker"
  sudo systemctl enable docker --now
}

function configure_vim {
  log_info "Installing vim."
  sudo pacman -S vim

  mkdir -p ~/.vim/autoload ~/.vim/bundle

  log_info "Setting up vim addon manager (pathogen)."

  curl -LSso ~/.vim/autoload/pathogen.vim https://raw.githubusercontent.com/tpope/vim-pathogen/master/autoload/pathogen.vim

  log_info "Cloning vim addons."

  get_latest_git https://github.com/vim-airline/vim-airline.git ~/.vim/bundle/airline
  get_latest_git https://github.com/tpope/vim-fugitive.git ~/.vim/bundle/fugitive
  get_latest_git https://github.com/mhinz/vim-signify.git ~/.vim/bundle/vim-signify
  get_latest_git https://github.com/morhetz/gruvbox.git ~/.vim/bundle/gruvbox

  rsync -av "$ROOT/dotfiles/.vimrc" ~/.vimrc
}

function configure_tmux {
  sudo pacman -S tmux
  rsync -av --delete "$ROOT/dotfiles/.config/tmux/" "$XDG_CONFIG_HOME/tmux/"
}
