#!/usr/bin/env bash
#
# This script will install and configure a given program.
# This script will handle a few different expected distros.
#
# Usage:
# setup COMMAND

set -e

THIS=$(realpath "$0")
HERE=$(dirname "$THIS")
ROOT=$(realpath "$HERE/..")

XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-$HOME/.config}

source $HERE/lib/logging.sh
source $HERE/lib/utils.sh

# -----------------------------------------------------
# Commands
# -----------------------------------------------------

function command_bash {
  configure_bash
}

function command_hypr {
  configure_hyprland
}

function command_docker {
  configure_docker
}

function command_vim {
  configure_vim
}

function command_tmux {
  configure_tmux
}

function command_help {
  log_info "The following commands can be used to configure the system:"
  local fn
  for fn in $(compgen -A function command_); do
    [ "$fn" = "command_help" ] && continue
    log_info "${fn#command_}"
  done
}

# -----------------------------------------------------
# Main
# -----------------------------------------------------

# Useful links:
# http://stackoverflow.com/questions/29581754
# https://github.com/which-distro/os-release
DISTRO_ID=$(awk -F'=' '/^ID=/ {print tolower($2)}' /etc/*-release 2> /dev/null)
SETUP_FILE="$HERE/setup-dist/$DISTRO_ID/setup"

if [ -f "$SETUP_FILE" ]; then
  source $SETUP_FILE
else
  log_error "Unsupported distro '$DISTRO_ID'. Exiting..."
  exit 1
fi

# Basically every command assumes that this directory exists.
mkdir -p $XDG_CONFIG_HOME

for WORD in $@; do
  CMD="command_${WORD}"
  $CMD
done
